<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no">
  <title>测试JsWebView框架</title>
  <script type="text/javascript">
    /*
     传递给WebView的数据结构:
     {
       "action": "action_name",
       "id": "random value",
       "callback": "function_name",
       "data": {}  // optional
     }
     action：操作名称，取名应该能反映其意义，例如getIp（获取ip地址）
     id：这次调用接口的id，因为交互是异步的，对同一个接口调用
     */
    function doGetIp() {
      var info = {
        "action": "getIp",
        "id": Math.random().toString(),
        "callback": "getIpCallback"
      }
      callNative(info)
    }

    /*
     result的结构:
     {
       "action": "getInfo",
       "id": "0.123123"
       "result": 1
       "data": {}  // optional
     }
     */
    function getIpCallback(result) {
      document.getElementById('ip_result').innerHTML = result.data.ip || '获取ip失败';
    }

    /*
      
    */
    function callNative(object) {
      if (window.liuhxJsSdk) {
        window.liuhxJsSdk.invoke(JSON.stringify(object))
      } else if ((window.webkit && window.webkit.messageHandlers.liuhxJsSdk)) {
        window.webkit.messageHandlers.liuhxJsSdk.postMessage(object)
      } else {
        alert("此功能需要在WebView中使用！")
      }
    }
  </script>
</head>

<body>
  <input type="button" onclick="doGetIp()" value="获取ip" />
  <br>
  <p id="ip_result">请点击获取ip，这里将显示结果</p>
</body>

</html>
